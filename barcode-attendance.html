<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Barcode Attendance System</title>
    <link rel="stylesheet" href="attendance.css">
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@latest/umd/index.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì College Barcode Attendance System</h1>
            <p>Smart ID Card Based Attendance Management</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('idcard')">üÜî ID Card Generator</button>
            <button class="tab" onclick="showTab('scanner')">üì± Barcode Scanner</button>
            <button class="tab" onclick="showTab('teacher')">üë®üè´ Teacher Portal</button>
        </div>
        
        <!-- ID Card Generator Tab -->
        <div id="idcard-tab" class="tab-content">
            <h2>Student ID Card Generator</h2>
            
            <div class="form-group">
                <label>Select Student:</label>
                <select id="studentSelect" onchange="generateIDCard()">
                    <option value="">Select a student</option>
                    <option value="STU001">Mayank Kushwaha - BCA 3rd Year</option>
                    <option value="STU002">Rahul Sharma - BCA 2nd Year</option>
                    <option value="STU003">Priya Singh - BCA 1st Year</option>
                    <option value="STU004">Amit Kumar - BCA 3rd Year</option>
                    <option value="STU005">Sneha Patel - BCA 2nd Year</option>
                </select>
            </div>
            
            <div id="idCardContainer"></div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="printIDCard()">üñ®Ô∏è Print ID Card</button>
            </div>
        </div>
        
        <!-- Scanner Tab -->
        <div id="scanner-tab" class="tab-content hidden">
            <h2>Barcode Scanner for Attendance</h2>
            
            <div class="scanner-container">
                <video id="scannerVideo" class="scanner-video" autoplay></video>
                <canvas id="scannerCanvas" class="hidden"></canvas>
                
                <div style="margin: 20px 0;">
                    <button class="btn" onclick="startScanner()">üì∑ Start Scanner</button>
                    <button class="btn btn-danger" onclick="stopScanner()">‚èπÔ∏è Stop Scanner</button>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="scanFromImage()">
                    <button class="btn btn-success" onclick="document.getElementById('imageUpload').click()">üñºÔ∏è Scan from Gallery</button>
                </div>
                
                <div id="scanResult"></div>
            </div>
        </div>
        
        <!-- Teacher Portal Tab -->
        <div id="teacher-tab" class="tab-content hidden">
            <h2>Teacher Portal - Attendance Dashboard</h2>
            
            <div class="attendance-summary">
                <div class="summary-card">
                    <div class="summary-number" id="totalStudents">5</div>
                    <div>Total Students</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="presentStudents">0</div>
                    <div>Present Today</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="absentStudents">5</div>
                    <div>Absent Today</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="attendanceRate">0%</div>
                    <div>Attendance Rate</div>
                </div>
            </div>
            
            <h3>Manual Attendance</h3>
            <div class="form-group">
                <label>Select Student:</label>
                <select id="manualStudentSelect">
                    <option value="">Select a student</option>
                    <option value="STU001">Mayank Kushwaha - BCA 3rd Year</option>
                    <option value="STU002">Rahul Sharma - BCA 2nd Year</option>
                    <option value="STU003">Priya Singh - BCA 1st Year</option>
                    <option value="STU004">Amit Kumar - BCA 3rd Year</option>
                    <option value="STU005">Sneha Patel - BCA 2nd Year</option>
                </select>
            </div>
            <button class="btn" onclick="markManualAttendance()">‚úì Mark Present</button>
            <button class="btn btn-danger" onclick="exportToExcel()">üìä Export to Excel</button>
            
            <h3 style="margin-top: 30px;">Today's Attendance</h3>
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Course</th>
                        <th>Time</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="attendanceTableBody">
                    <!-- Attendance records will be populated here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <script src="attendance.js"></script>
</body>
</html> - Attendance Dashboard</h2>
            
            <div class="attendance-summary">
                <div class="summary-card">
                    <div class="summary-number" id="totalStudents">5</div>
                    <div>Total Students</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="presentStudents">0</div>
                    <div>Present Today</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="absentStudents">5</div>
                    <div>Absent Today</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="attendanceRate">0%</div>
                    <div>Attendance Rate</div>
                </div>
            </div>
            
            <h3>Manual Attendance</h3>
            <div class="form-group">
                <label>Select Student:</label>
                <select id="manualStudentSelect">
                    <option value="">Select a student</option>
                    <option value="STU001">Mayank Kushwaha - BCA 3rd Year</option>
                    <option value="STU002">Rahul Sharma - BCA 2nd Year</option>
                    <option value="STU003">Priya Singh - BCA 1st Year</option>
                    <option value="STU004">Amit Kumar - BCA 3rd Year</option>
                    <option value="STU005">Sneha Patel - BCA 2nd Year</option>
                </select>
            </div>
            <button class="btn" onclick="markManualAttendance()">‚úì Mark Present</button>
            <button class="btn btn-danger" onclick="exportToExcel()">üìä Export to Excel</button>
            
            <h3 style="margin-top: 30px;">Today's Attendance</h3>
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Course</th>
                        <th>Time</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="attendanceTableBody">
                    <!-- Attendance records will be populated here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // Student Database
        const students = {
            'STU001': { name: 'Mayank Kushwaha', course: 'BCA 3rd Year', photo: 'MK' },
            'STU002': { name: 'Rahul Sharma', course: 'BCA 2nd Year', photo: 'RS' },
            'STU003': { name: 'Priya Singh', course: 'BCA 1st Year', photo: 'PS' },
            'STU004': { name: 'Amit Kumar', course: 'BCA 3rd Year', photo: 'AK' },
            'STU005': { name: 'Sneha Patel', course: 'BCA 2nd Year', photo: 'SP' }
        };
        
        let attendanceRecords = [];
        let codeReader = null;
        let stream = null;
        
        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            if (tabName === 'teacher') {
                updateDashboard();
            }
        }
        
        // ID Card Generator
        function generateIDCard() {
            const studentId = document.getElementById('studentSelect').value;
            if (!studentId) return;
            
            const student = students[studentId];
            const container = document.getElementById('idCardContainer');
            
            container.innerHTML = `
                <div class="id-card">
                    <div class="college-name">SHAMBHUNATH COLLEGE</div>
                    <div class="student-info">
                        <div class="student-photo">${student.photo}</div>
                        <div class="student-details">
                            <h3>${student.name}</h3>
                            <p>ID: ${studentId}</p>
                            <p>${student.course}</p>
                        </div>
                    </div>
                    <div class="barcode-section">
                        <svg id="barcode-${studentId}"></svg>
                        <div style="color: #333; font-size: 10px; margin-top: 5px;">${studentId}</div>
                    </div>
                </div>
            `;
            
            // Generate barcode
            JsBarcode(`#barcode-${studentId}`, studentId, {
                format: "CODE128",
                width: 2,
                height: 40,
                displayValue: false
            });
        }
        
        function printIDCard() {
            const idCard = document.querySelector('.id-card');
            if (!idCard) {
                alert('Please generate an ID card first!');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Print ID Card</title>
                        <style>
                            body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
                            ${document.querySelector('style').innerHTML}
                        </style>
                    </head>
                    <body>
                        ${idCard.outerHTML}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Barcode Scanner
        async function startScanner() {
            try {
                codeReader = new ZXing.BrowserMultiFormatReader();
                const videoElement = document.getElementById('scannerVideo');
                
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                videoElement.srcObject = stream;
                
                codeReader.decodeFromVideoDevice(null, 'scannerVideo', (result, err) => {
                    if (result) {
                        processBarcode(result.text);
                    }
                });
                
                document.getElementById('scanResult').innerHTML = '<div class="success">Scanner started. Point camera at barcode.</div>';
            } catch (err) {
                document.getElementById('scanResult').innerHTML = '<div class="error">Error starting scanner: ' + err.message + '</div>';
            }
        }
        
        function stopScanner() {
            if (codeReader) {
                codeReader.reset();
            }
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('scanResult').innerHTML = '<div class="error">Scanner stopped.</div>';
        }
        
        // Gallery Image Scanner
        function scanFromImage() {
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.getElementById('scannerCanvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    
                    try {
                        const codeReader = new ZXing.BrowserMultiFormatReader();
                        codeReader.decodeFromImageData(imageData)
                            .then(result => {
                                processBarcode(result.text);
                            })
                            .catch(err => {
                                document.getElementById('scanResult').innerHTML = '<div class="error">No barcode found in image.</div>';
                            });
                    } catch (err) {
                        document.getElementById('scanResult').innerHTML = '<div class="error">Error scanning image: ' + err.message + '</div>';
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function processBarcode(studentId) {
            if (students[studentId]) {
                markAttendance(studentId);
            } else {
                document.getElementById('scanResult').innerHTML = '<div class="error">Invalid student ID: ' + studentId + '</div>';
            }
        }
        
        function markAttendance(studentId) {
            const student = students[studentId];
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            // Check if already marked today
            const today = now.toDateString();
            const existingRecord = attendanceRecords.find(record => 
                record.studentId === studentId && record.date === today
            );
            
            if (existingRecord) {
                document.getElementById('scanResult').innerHTML = 
                    `<div class="error">Attendance already marked for ${student.name} today at ${existingRecord.time}</div>`;
                return;
            }
            
            // Add attendance record
            attendanceRecords.push({
                studentId: studentId,
                name: student.name,
                course: student.course,
                time: timeString,
                date: today
            });
            
            document.getElementById('scanResult').innerHTML = 
                `<div class="success">‚úÖ Attendance marked for ${student.name} at ${timeString}</div>`;
            
            updateDashboard();
        }
        
        // Teacher Portal Functions
        function markManualAttendance() {
            const studentId = document.getElementById('manualStudentSelect').value;
            if (!studentId) {
                alert('Please select a student!');
                return;
            }
            markAttendance(studentId);
            document.getElementById('manualStudentSelect').value = '';
        }
        
        function updateDashboard() {
            const today = new Date().toDateString();
            const todayRecords = attendanceRecords.filter(record => record.date === today);
            
            const totalStudents = Object.keys(students).length;
            const presentStudents = todayRecords.length;
            const absentStudents = totalStudents - presentStudents;
            const attendanceRate = totalStudents > 0 ? Math.round((presentStudents / totalStudents) * 100) : 0;
            
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('presentStudents').textContent = presentStudents;
            document.getElementById('absentStudents').textContent = absentStudents;
            document.getElementById('attendanceRate').textContent = attendanceRate + '%';
            
            // Update attendance table
            const tableBody = document.getElementById('attendanceTableBody');
            tableBody.innerHTML = '';
            
            todayRecords.forEach(record => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${record.studentId}</td>
                    <td>${record.name}</td>
                    <td>${record.course}</td>
                    <td>${record.time}</td>
                    <td><span class="status-present">Present</span></td>
                `;
            });
        }
        
        function exportToExcel() {
            const today = new Date().toDateString();
            const todayRecords = attendanceRecords.filter(record => record.date === today);
            
            let csvContent = "Student ID,Name,Course,Time,Status\n";
            todayRecords.forEach(record => {
                csvContent += `${record.studentId},${record.name},${record.course},${record.time},Present\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `attendance_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
        });
    </script>
</body>
</html>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="presentToday">0</div>
                    <div>Present Today</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="absentToday">0</div>
                    <div>Absent Today</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="attendancePercentage">0%</div>
                    <div>Attendance %</div>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="exportAttendance()">üìä Export to Excel</button>
                <button class="btn btn-success" onclick="markAllPresent()">‚úÖ Mark All Present</button>
                <button class="btn btn-danger" onclick="clearTodayAttendance()">üóëÔ∏è Clear Today</button>
            </div>
            
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Class</th>
                        <th>Status</th>
                        <th>Time</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="attendanceTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Student Database
        const students = {
            'STU001': { name: 'Mayank Kushwaha', class: 'BCA 3rd Year', rollNo: '21001', photo: 'üë®' },
            'STU002': { name: 'Rahul Sharma', class: 'BCA 2nd Year', rollNo: '22001', photo: 'üë¶' },
            'STU003': { name: 'Priya Singh', class: 'BCA 1st Year', rollNo: '23001', photo: 'üë©' },
            'STU004': { name: 'Amit Kumar', class: 'BCA 3rd Year', rollNo: '21002', photo: 'üë®' },
            'STU005': { name: 'Sneha Patel', class: 'BCA 2nd Year', rollNo: '22002', photo: 'üë©' }
        };
        
        // Attendance Storage
        let attendanceRecords = JSON.parse(localStorage.getItem('collegeAttendance')) || [];
        let scanning = false;
        let codeReader = null;
        
        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            if (tabName === 'teacher') {
                updateTeacherDashboard();
            }
        }
        
        // Generate ID Card
        function generateIDCard() {
            const studentId = document.getElementById('studentSelect').value;
            if (!studentId) return;
            
            const student = students[studentId];
            const container = document.getElementById('idCardContainer');
            
            container.innerHTML = `
                <div class="id-card">
                    <div class="college-name">SHAMBHUNATH COLLEGE OF EDUCATION</div>
                    <div class="student-info">
                        <div class="student-photo">${student.photo}</div>
                        <div class="student-details">
                            <h3>${student.name}</h3>
                            <p>Roll No: ${student.rollNo}</p>
                            <p>Class: ${student.class}</p>
                            <p>ID: ${studentId}</p>
                        </div>
                    </div>
                    <div class="barcode-section">
                        <svg id="barcode-${studentId}"></svg>
                        <div style="font-size: 10px; color: #333; margin-top: 5px;">${studentId}</div>
                    </div>
                </div>
            `;
            
            // Generate barcode
            JsBarcode(`#barcode-${studentId}`, studentId, {
                format: "CODE128",
                width: 2,
                height: 40,
                displayValue: false
            });
        }
        
        // Print ID Card
        function printIDCard() {
            const idCard = document.querySelector('.id-card');
            if (!idCard) {
                alert('Please generate an ID card first');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Print ID Card</title>
                        <style>
                            body { margin: 0; padding: 20px; }
                            .id-card { 
                                width: 350px; height: 220px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                border-radius: 15px; padding: 20px; color: white; box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                            }
                            .college-name { font-size: 14px; font-weight: bold; text-align: center; margin-bottom: 10px; }
                            .student-info { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
                            .student-photo { width: 60px; height: 60px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #333; }
                            .student-details h3 { font-size: 16px; margin-bottom: 5px; }
                            .student-details p { font-size: 12px; opacity: 0.9; }
                            .barcode-section { text-align: center; background: white; padding: 10px; border-radius: 8px; margin-top: 10px; }
                        </style>
                    </head>
                    <body>${idCard.outerHTML}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Start Barcode Scanner
        function startScanner() {
            const video = document.getElementById('scannerVideo');
            
            if (!codeReader) {
                codeReader = new ZXing.BrowserBarcodeReader();
            }
            
            codeReader.decodeFromVideoDevice(null, video, (result, err) => {
                if (result) {
                    const studentId = result.text;
                    markAttendance(studentId);
                }
            });
            
            scanning = true;
            showMessage('Scanner started. Show barcode to camera.', 'success');
        }
        
        // Stop Scanner
        function stopScanner() {
            if (codeReader) {
                codeReader.reset();
            }
            scanning = false;
            showMessage('Scanner stopped.', 'error');
        }
        
        // Mark Attendance
        function markAttendance(studentId) {
            if (!students[studentId]) {
                showMessage('Invalid student ID: ' + studentId, 'error');
                return;
            }
            
            const student = students[studentId];
            const now = new Date();
            const today = now.toDateString();
            
            // Check if already marked today
            const existingRecord = attendanceRecords.find(record => 
                record.studentId === studentId && record.date === today
            );
            
            if (existingRecord) {
                showMessage(`${student.name} already marked present today!`, 'error');
                return;
            }
            
            // Add attendance record
            const record = {
                studentId: studentId,
                name: student.name,
                class: student.class,
                date: today,
                time: now.toLocaleTimeString(),
                timestamp: now.getTime()
            };
            
            attendanceRecords.push(record);
            localStorage.setItem('collegeAttendance', JSON.stringify(attendanceRecords));
            
            showMessage(`‚úÖ ${student.name} marked present at ${record.time}`, 'success');
            
            // Auto-switch to teacher portal to show updated attendance
            setTimeout(() => {
                showTab('teacher');
                document.querySelector('[onclick="showTab(\'teacher\')"]').classList.add('active');
            }, 2000);
        }
        
        // Show Message
        function showMessage(message, type) {
            const resultDiv = document.getElementById('scanResult');
            resultDiv.innerHTML = `<div class="${type}">${message}</div>`;
            
            setTimeout(() => {
                resultDiv.innerHTML = '';
            }, 5000);
        }
        
        // Update Teacher Dashboard
        function updateTeacherDashboard() {
            const today = new Date().toDateString();
            const todayRecords = attendanceRecords.filter(record => record.date === today);
            
            // Update summary cards
            const totalStudents = Object.keys(students).length;
            const presentToday = todayRecords.length;
            const absentToday = totalStudents - presentToday;
            const attendancePercentage = totalStudents > 0 ? Math.round((presentToday / totalStudents) * 100) : 0;
            
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('presentToday').textContent = presentToday;
            document.getElementById('absentToday').textContent = absentToday;
            document.getElementById('attendancePercentage').textContent = attendancePercentage + '%';
            
            // Update attendance table
            const tableBody = document.getElementById('attendanceTableBody');
            tableBody.innerHTML = '';
            
            Object.keys(students).forEach(studentId => {
                const student = students[studentId];
                const record = todayRecords.find(r => r.studentId === studentId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${studentId}</td>
                    <td>${student.name}</td>
                    <td>${student.class}</td>
                    <td>${record ? '<span class="status-present">Present</span>' : 'Absent'}</td>
                    <td>${record ? record.time : '--'}</td>
                    <td>
                        ${!record ? `<button class="btn" onclick="manualAttendance('${studentId}')">Mark Present</button>` : 'Marked'}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Manual Attendance
        function manualAttendance(studentId) {
            markAttendance(studentId);
            updateTeacherDashboard();
        }
        
        // Mark All Present
        function markAllPresent() {
            if (confirm('Mark all students present for today?')) {
                Object.keys(students).forEach(studentId => {
                    const today = new Date().toDateString();
                    const existingRecord = attendanceRecords.find(record => 
                        record.studentId === studentId && record.date === today
                    );
                    
                    if (!existingRecord) {
                        markAttendance(studentId);
                    }
                });
                updateTeacherDashboard();
                alert('All students marked present!');
            }
        }
        
        // Clear Today's Attendance
        function clearTodayAttendance() {
            if (confirm('Clear all attendance records for today?')) {
                const today = new Date().toDateString();
                attendanceRecords = attendanceRecords.filter(record => record.date !== today);
                localStorage.setItem('collegeAttendance', JSON.stringify(attendanceRecords));
                updateTeacherDashboard();
                alert('Today\'s attendance cleared!');
            }
        }
        
        // Export Attendance
        function exportAttendance() {
            const today = new Date().toDateString();
            const todayRecords = attendanceRecords.filter(record => record.date === today);
            
            let csvContent = "Student ID,Name,Class,Status,Time\n";
            
            Object.keys(students).forEach(studentId => {
                const student = students[studentId];
                const record = todayRecords.find(r => r.studentId === studentId);
                
                csvContent += `${studentId},${student.name},${student.class},${record ? 'Present' : 'Absent'},${record ? record.time : '--'}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `attendance_${today.replace(/\s+/g, '_')}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateTeacherDashboard();
        });
    </script>
</body>
</html>